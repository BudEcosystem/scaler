---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: podautoscalers.autoscaling.aibrix.ai
spec:
  group: autoscaling.aibrix.ai
  names:
    kind: PodAutoscaler
    listKind: PodAutoscalerList
    plural: podautoscalers
    singular: podautoscaler
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.minReplicas
      name: MINPODS
      type: integer
    - jsonPath: .spec.maxReplicas
      name: MAXPODS
      type: integer
    - jsonPath: .status.actualScale
      name: REPLICAS
      type: integer
    - jsonPath: .spec.scalingStrategy
      name: STRATEGY
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: AGE
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          PodAutoscaler is the Schema for the podautoscalers API, a resource to scale Kubernetes pods based on observed metrics.
          The fields in the spec determine how the scaling behavior should be applied.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Spec defines the desired behavior of the PodAutoscaler.
            properties:
              maxReplicas:
                description: |-
                  MaxReplicas is the maximum number of replicas to which the target can be scaled up.
                  It cannot be less than minReplicas
                format: int32
                type: integer
              metricsSources:
                description: MetricsSources defines a list of sources from which metrics
                  are collected to make scaling decisions.
                items:
                  description: MetricSource defines an endpoint and path from which
                    metrics are collected.
                  properties:
                    endpoint:
                      description: External service endpoint (e.g., gpu-optimizer.aibrix-system.svc.cluster.local)
                      type: string
                    metricSourceType:
                      description: 'Specifies how to fetch metrics: from individual
                        pods, Kubernetes APIs, or external services'
                      enum:
                      - pod
                      - resource
                      - custom
                      - external
                      - domain
                      type: string
                    path:
                      description: Path to metrics endpoint (e.g., /api/metrics/cpu)
                      type: string
                    port:
                      description: Port for pod-level metrics. Only used for 'pod'
                        type.
                      type: string
                    protocolType:
                      description: Protocol for metric collection. Required only for
                        'pod' and 'external' types.
                      enum:
                      - http
                      - https
                      type: string
                    targetMetric:
                      description: TargetMetric identifies the specific metric to
                        monitor (e.g., kv_cache_utilization).
                      type: string
                    targetValue:
                      description: TargetValue sets the desired threshold for the
                        metric (e.g., 50 for 50% utilization).
                      type: string
                  required:
                  - metricSourceType
                  - targetMetric
                  - targetValue
                  type: object
                minItems: 1
                type: array
              minReplicas:
                description: MinReplicas is the minimum number of replicas to which
                  the target can be scaled down.
                format: int32
                type: integer
              scaleTargetRef:
                description: |-
                  INSERT ADDITIONAL SPEC FIELDS - desired state of cluster
                  Important: Run "make" to regenerate code after modifying this file
                  ScaleTargetRef points to scale-able resource that this PodAutoscaler should target and scale. e.g. Deployment
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              scalingStrategy:
                description: ScalingStrategy defines the strategy to use for scaling.
                enum:
                - HPA
                - KPA
                - APA
                type: string
              subTargetSelector:
                description: |-
                  SubTargetSelector selects a sub-component within the target resource
                  For StormService/RoleSet: selects a role by roleName
                  If not specified, scales the entire resource
                properties:
                  roleName:
                    description: RoleName selects a role within StormService or RoleSet
                    type: string
                type: object
            required:
            - maxReplicas
            - scaleTargetRef
            - scalingStrategy
            type: object
          status:
            description: Status represents the current information about the PodAutoscaler.
            properties:
              actualScale:
                description: |-
                  ActualScale represents the actual number of running instances of the scaled target.
                  it may be different from DesiredScale
                format: int32
                type: integer
              conditions:
                description: |-
                  Conditions is the set of conditions required for this autoscaler to scale its target,
                  and indicates whether or not those conditions are met.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              desiredScale:
                description: |-
                  DesiredScale represents the desired number of instances computed by the PodAutoscaler based on the current metrics.
                  it's computed according to Scaling policy after observing service metrics
                format: int32
                type: integer
              lastScaleTime:
                description: |-
                  LastScaleTime is the last time the PodAutoscaler scaled the number of pods,
                  used by the autoscaler to control how often the number of pods is changed.
                format: date-time
                type: string
              scalingHistory:
                description: ScalingHistory stores the last N scaling decisions
                items:
                  description: ScalingDecision represents a single scaling decision
                    made by the autoscaler
                  properties:
                    error:
                      description: Error message if the scaling failed
                      type: string
                    newScale:
                      description: NewScale is the number of replicas after scaling
                      format: int32
                      type: integer
                    previousScale:
                      description: PreviousScale is the number of replicas before
                        scaling
                      format: int32
                      type: integer
                    reason:
                      description: Reason provides the explanation for the scaling
                        decision
                      type: string
                    success:
                      description: Success indicates whether the scaling operation
                        succeeded
                      type: boolean
                    timestamp:
                      description: Timestamp when the scaling decision was made
                      format: date-time
                      type: string
                  required:
                  - newScale
                  - previousScale
                  - reason
                  - success
                  - timestamp
                  type: object
                maxItems: 5
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
